<!-- TODO: Add instructions on building Dockerfile -->
# spark

Working repository for running spark TPCSDS benchmark on AKS

## Contents

| File/folder       | Description                                  |
| ----------------- | ---------------------------------------------|
| `Dockerfile`      | Dockerfile to build environment              |
| `tpcds_jar`       | Folder contains jar files to tpcds execution |
| `tpcds-kit`       | Spark Docker containers and config           |


# Spark env Dockerfile
It is using the 
      Hadoop version 3.3.0 
      Spark Version 3.0.0

and setting the SPARK_HOME = '/opt/spark'.

It is adding SPARK_HOME to the PATH as well.

Dockerfile is to create a container for spark TPCDS. This container will install the necessary tools (tpcds-toolkit, databricks tpcds library, spark 3.0, sbt) to build an application that generate TPCDS data. This container will be used to execute a benchmark upon this data.

Dockerfile copies tpcds_jars to /opt/spark/jars in the container.

# Build databricks Spark Sql perf library

Follow the steps given in GitHub for the Spark Sql library to create a jar file, and move the jar file under tpcds_jars

`git clone https://github.com/databricks/spark-sql-perf` 

The output of your build will be the spark-sql-pref_xxx.jar. Sample is as below:
| `spark-sql=perf_2.12_latest.jar`      | This jar file is compatible with version Spark 3.0.

# Arguments for the com.databricks.spark.sql.perf.tpcds.TPCDSTables genData method

| File                  | Description                                                                            |
| --------------------  | ---------------------------------------------------------------------------------------|
| `tpcdsDataDir`        | Direcory for tpcsds-data.                                                              |
|                       | This data is generated by tpcds Data Generator class and stored in this location.      |
| `resultLocation`      | Output location for the TPCSDSBenchmark execution class.                               |
| `tpcdsDataDir`        | Direcory for tpcsds-data.                                                              |
| `format`    `         | As of now we are supporting only parquet.                                              |
| `iterations`    `     | Direcory for tpcsds-data.                                                              |
| `queryFilter`    `    | We can specify the number of query we want TPCDSBenchmark to execute.                  |

